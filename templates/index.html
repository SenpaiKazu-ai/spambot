<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SPAM SHARE TOOL</title>
    <style>
      :root {
        --bg: #f5f5f5;
        --text: #333;
        --accent: #007bff;
        --input-bg: #fff;
        --border: #ddd;
      }
      * { box-sizing: border-box; }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        background: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: calc(100vh - 40px);
        text-align: center;
      }

      .panel {
        background: #fff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        width: 100%;
        max-width: 500px;
        border: 1px solid var(--border);
      }

      h2 {
        margin: 0 0 24px 0;
        font-size: 28px;
        font-weight: 600;
        color: var(--text);
      }

      label {
        display: block;
        text-align: left;
        margin-top: 16px;
        margin-bottom: 6px;
        font-weight: 500;
        font-size: 14px;
      }

      input, textarea {
        width: 100%;
        padding: 12px;
        margin-bottom: 12px;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: var(--input-bg);
        color: var(--text);
        font-size: 14px;
        outline: none;
        font-family: inherit;
      }

      input:focus, textarea:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
      }

      button {
        width: 100%;
        padding: 12px 16px;
        border: none;
        border-radius: 6px;
        background: var(--accent);
        color: white;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.2s;
      }
      button:hover:not(:disabled) { background: #0056b3; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }

      #result { 
        margin-top: 16px; 
        font-weight: 500; 
        min-height: 20px; 
        padding: 12px;
        border-radius: 6px;
        background: #f9f9f9;
        border: 1px solid var(--border);
      }

      .success { color: #28a745; background: #f0f9f3; border-color: #c3e6cb; }
      .error { color: #dc3545; background: #fdf5f5; border-color: #f5c6cb; }
      .info { color: #0056b3; background: #f0f5ff; border-color: #bce7ff; }

      footer { 
        margin-top: 24px; 
        font-size: 12px; 
        color: #666; 
        text-align: center; 
      }

      @media (max-width:480px) {
        .panel { padding: 24px; }
        h2 { font-size: 24px; }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="panel">
        <h2>Facebook Share Tool</h2>
        
        <label for="linkToPost">Post Link *</label>
        <input type="text" id="linkToPost" placeholder="https://facebook.com/..." />
        
        <label for="shareCount">Number of Shares *</label>
        <input type="number" id="shareCount" min="1" value="1" />
        
        <label for="cookieInput">Facebook Cookie *</label>
        <textarea id="cookieInput" rows="5" placeholder="Paste your Facebook cookie here..."></textarea>
        
        <button id="shareBtn" onclick="convertAndShare()">Share</button>
        
        <div id="result"></div>
      </div>
    </div>

    <footer>⚠️ This tool is for educational purposes only. Use responsibly.</footer>

    <script>
      async function convertAndShare() {
        const link = document.getElementById('linkToPost').value.trim();
        const count = parseInt(document.getElementById('shareCount').value) || 1;
        const cookie = document.getElementById('cookieInput').value.trim();
        const result = document.getElementById('result');

        if (!link) {
          result.className = 'error';
          result.textContent = "Please enter a post link";
          return;
        }

        if (!cookie) {
          result.className = 'error';
          result.textContent = "Please enter a Facebook cookie";
          return;
        }

        const shareBtn = document.getElementById('shareBtn');
        shareBtn.disabled = true;
        result.className = 'info';
        result.textContent = "Converting cookie to tokens...";

        try {
          // First, convert cookie to tokens
          const convertResponse = await fetch('/convert-cookie', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ cookie })
          });

          if (!convertResponse.ok) {
            const errorText = await convertResponse.text();
            console.error('Conversion error:', convertResponse.status, errorText);
            result.className = 'error';
            result.textContent = `Conversion failed (${convertResponse.status}): ${errorText || 'Server error'}`;
            return;
          }

          let convertData;
          try {
            const responseText = await convertResponse.text();
            console.log('Conversion response:', responseText);
            if (!responseText) {
              throw new Error('Empty response');
            }
            convertData = JSON.parse(responseText);
          } catch (parseErr) {
            console.error('Parse error:', parseErr);
            result.className = 'error';
            result.textContent = "Invalid server response during conversion";
            return;
          }

          const tokens = convertData.tokens;
          if (!tokens || !tokens.length) {
            result.className = 'error';
            result.textContent = "No tokens generated from cookie";
            return;
          }

          result.className = 'info';
          result.textContent = `Cookie converted! ${tokens.length} token(s) found. Starting share process...`;

          // Now share with converted tokens
          const shareResponse = await fetch('/api/share', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              link,
              accessToken: tokens,
              count
            })
          });

          if (!shareResponse.ok) {
            const errorText = await shareResponse.text();
            result.className = 'error';
            result.textContent = `Sharing failed: ${errorText || 'Server error'}`;
            return;
          }

          let shareData;
          try {
            shareData = await shareResponse.json();
          } catch (parseErr) {
            result.className = 'error';
            result.textContent = "Invalid server response during sharing";
            return;
          }

          const summary = shareData.summary;
          result.className = 'success';
          result.textContent = `✓ Complete: ${summary.successful_shares} successful, ${summary.failed_shares} failed out of ${summary.total_attempts} attempts`;
        } catch (err) {
          result.className = 'error';
          result.textContent = `Error: ${err.message}`;
        } finally {
          shareBtn.disabled = false;
        }
      }
    </script>
  </body>
</html>





